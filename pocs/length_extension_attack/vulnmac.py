#!/usr/bin/env python2
# encoding: utf-8

import hashlib
import sys
import argparse

parser = argparse.ArgumentParser()
parser.add_argument("mode", choices=('generate', 'verify'))

args = parser.parse_args()

SECRET = "foobar"

if args.mode == 'generate':
    msg = "username=test&admin=0"
    md = hashlib.md5()
    md.update(SECRET + msg)
    mac = md.hexdigest()
    print(msg)
    print(mac)
elif args.mode == 'verify':
    data = sys.stdin.read().rstrip()
    msg, mac = data.rsplit("\n", 1)

    print repr(msg), mac

    md = hashlib.md5()
    md.update(SECRET + msg)
    if mac.strip() == md.hexdigest():
        print("VALID")
    else:
        print("INVALID")
