#!/usr/bin/env python

import cgitb; cgitb.enable()
import sys
import os
sys.path.append(os.path.dirname(__file__))
import utils
from utils import Headers

#utils.send_response('test')

origin = os.environ.get('HTTP_ORIGIN', '*')

headers = Headers()
headers['Access-Control-Allow-Origin'] = origin
headers['Access-Control-Allow-Credentials'] = 'true'
headers['Set-Cookie'] = 'sessionid=1234'
headers['Set-Cookie'] = 'sessionid2=5678; HttpOnly'


html = """
Please enter your name:
<input type="text" id="name" />
<button onclick="document.cookie='name='+document.getElementById('name').value;location.reload()">Save</button>
"""

if utils.get_cookie('name'):
    html = "Hello %s" % (utils.get_cookie('name') or 'nobody')

utils.send_response(html, headers)
